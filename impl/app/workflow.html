<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head><meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" type="text/css" href="../../res/Products.RiplaLayout/styles.css" />

    <title>Configuration Workflow</title>
    
    <meta name="generator" content="Silva" />
    
    <link rel="shortcut icon" href="../../res/silva.core.layout.porto/favicon.ico" />

    <!-- Injector for on-the-fly inclusion -->
    


  </head>

  <body id="workflow">
    <div class="wrapper">
  <header>
    <h1 class="header">
        <a href="../.."
           title="Ripla [Top]">Ripla</a>  
    </h1>
    <p class="header">Rich Platform project for Java web applications.</p>
    <ul>
      <li class="download"><a class="buttons" href="http://aktion-hip.github.io/ripla/downloads/" target="_blank">Download Files</a></li>
      <li class="download"><a class="buttons" href="https://github.com/aktion-hip/ripla/zipball/master" target="_blank">Download ZIP</a></li>
      <li class="download"><a class="buttons" href="https://github.com/aktion-hip/ripla/tarball/master" target="_blank">Download TAR</a></li>
      <li><a class="buttons github" href="https://github.com/aktion-hip/ripla">View On GitHub</a></li>
    </ul>
    <p class="header">This project is maintained by <a class="header name" href="https://github.com/aktion-hip">aktion-hip</a></p>
  </header>
  
  <sidebar>
    <ul>
      <div class="navigation">
  <ul id="navigation-menu" class="navigation-level-0">
    
      <li class="level-0 selected">
        <a href="../../impl" title="Create Application" class="onbranch">Create Application</a>
        
          
            <ul class="navigation-level-1">
    
      <li class="level-1 selected">
        <a href="../../impl/app" title="Create an Application Bundle" class="onbranch">Create an Application Bundle</a>
        
          
            <ul class="navigation-level-2">
    
      <li class="level-2">
        <a href="../../impl/app/config.html" title="Application Configuration">Application Configuration</a>
        
      </li>
    
    
      <li class="level-2">
        <a href="../../impl/app/body.html" title="Application Layout">Application Layout</a>
        
      </li>
    
    
      <li class="level-2">
        <a href="../../impl/app/users.html" title="Users and Permissions">Users and Permissions</a>
        
      </li>
    
    
      <li class="level-2 selected">
        <a href="../../impl/app/workflow.html" title="Configuration Workflow" class="selected">Configuration Workflow</a>
        
      </li>
    
  </ul>
          
        
      </li>
    
    
      <li class="level-1">
        <a href="../../impl/usecase" title="Use Case Bundle">Use Case Bundle</a>
        
      </li>
    
    
      <li class="level-1">
        <a href="../../impl/skin" title="Ripla Skins">Ripla Skins</a>
        
      </li>
    
  </ul>
          
        
      </li>
    
    
      <li class="level-0">
        <a href="../../extend" title="Extension Points">Extension Points</a>
        
      </li>
    
    
      <li class="level-0">
        <a href="../../demo" title="Ripla Demo Application">Ripla Demo Application</a>
        
      </li>
    
    
      <li class="level-0">
        <a href="../../downloads" title="Downloads">Downloads</a>
        
      </li>
    
  </ul>
</div>

    </ul>    
  </sidebar>
  
  <section>
  <h1>Configuration Workflow</h1>
  <p>If you develop a web application intended to be downloaded and installed by users, most probaly you'll have to provide some tools for that the users can configure the application they installed. For example, if the web application stores data in a database, the users have to configure the access to the database.</p>

<p>The Ripla plattform provides the possibility to create a configuration workflow that runs the first time the user invokes the installed application. This offeres an easy approach for initial application configuration.<br></p>

<p>To install a configuration workflow, you have to override the method <span class="underline">RiplaApplication.beforeLogin()</span>. In this method, you can initiate the workflow<span class="underline"></span>, e.g.:</p>

<pre>protected boolean beforeLogin(final Window inMain, final IWorkflowListener inWorkflowListener) {
&#160;&#160;&#160; try {
&#160;&#160;&#160; &#160;&#160;&#160; MyWorkflow.createWorkflow(inMain, inWorkflowListener).startWorkflow();
&#160;&#160;&#160; }
&#160;&#160;&#160; catch (final WorkflowException exc) {
&#160;&#160;&#160; &#160;&#160;&#160; LOG.error("Error encountered during application configuration!", exc);
&#160;&#160;&#160; }
&#160;&#160;&#160; return false;
}</pre>

<p>Note the workflow listener instance passed to the worklow. <br></p>

<pre>public interface IWorkflowListener {
&#160;&#160;&#160; void workflowExit(int inReturnCode, String inMessage);
}
</pre>

<p>The listener instance in this case is <span class="underline">RiplaApplication</span>. You, therefore, have to override the callback method&#160;<span class="underline">RiplaApplication.workflowExit()</span>:</p>

<pre>public void workflowExit(int inReturnCode, String inMessage) {
&#160;&#160;&#160; switch (inReturnCode) {
&#160;&#160;&#160; case 1: // OK
&#160;&#160;&#160; &#160;&#160;&#160; setMainWindow(getLoginView());
&#160;&#160;&#160; &#160;&#160;&#160; break;
&#160;&#160;&#160; default:
&#160;&#160;&#160; &#160;&#160;&#160; getMainWindow().showNotification(inMessage);
&#160;&#160;&#160; }
}
</pre>

<p>The workflow class could look as follows:</p>

<pre>private static class MyWorkflow {
&#160;&#160;&#160; private IWorkflowItem workflowItem;
&#160;&#160;&#160; private IWorkflowListener workflowListener;
 
&#160;&#160;&#160; private MyWorkflow(final IWorkflowItem inWorklowItem,
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; final IWorkflowListener inListener) {
&#160;&#160;&#160; &#160;&#160;&#160; workflowItem = inWorklowItem;
&#160;&#160;&#160; &#160;&#160;&#160; workflowListener = inListener;
&#160;&#160;&#160; }
 
&#160;&#160;&#160; public void startWorkflow() throws WorkflowException {
&#160;&#160;&#160; &#160;&#160;&#160; workflowItem.run(this);
&#160;&#160;&#160; }
 
&#160;&#160;&#160; public int getReturnCode() {
&#160;&#160;&#160; &#160;&#160;&#160; return workflowItem.getReturnCode();
&#160;&#160;&#160; }
 
&#160;&#160;&#160; protected void nextStep() {
&#160;&#160;&#160; &#160;&#160;&#160; try {
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; if (workflowItem.hasNextStep()) {
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; workflowItem = workflowItem.getNextStep();
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; workflowItem.run(this);
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; } else {
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; workflowListener.workflowExit(workflowItem.getReturnCode(), "");
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; }
&#160;&#160;&#160; &#160;&#160;&#160; }
&#160;&#160;&#160; &#160;&#160;&#160; catch (final WorkflowException exc) {
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; workflowListener.workflowExit(-1, workflowItem.getErrorMessage());
&#160;&#160;&#160; &#160;&#160;&#160; }
&#160;&#160;&#160; }
 
&#160;&#160;&#160; public static MyWorkflow createWorkflow(final Window inWindow, final IWorkflowListener inListener) {
&#160;&#160;&#160; &#160;&#160;&#160; // instantiate the workflow steps we need
&#160;&#160;&#160; &#160;&#160;&#160; final IWorkflowItem step1 = new WorkflowStep1(inWindow);
&#160;&#160;&#160; &#160;&#160;&#160; final IWorkflowItem step2 = new WorkflowStep2();
&#160;&#160;&#160; &#160;&#160;&#160; final IWorkflowItem step3 = new WorkflowStep3();
 
&#160;&#160;&#160; &#160;&#160;&#160; // wire the workflow steps
&#160;&#160;&#160; &#160;&#160;&#160; step1.registerSuccessItem(step2);
 
&#160;&#160;&#160; &#160;&#160;&#160; step2.registerSuccessItem(step3);
&#160;&#160;&#160; &#160;&#160;&#160; step2.registerFailureItem(step1);
 
&#160;&#160;&#160; &#160;&#160;&#160; final MyWorkflow workflow = new MyWorkflow(step1, inListener);
&#160;&#160;&#160; &#160;&#160;&#160; return workflow;
&#160;&#160;&#160; }
}</pre>

<p>The workflow configuration is done in the factory method <span class="underline">MyWorkflow.createWorkflow()</span>. This example consists of three workflow steps. Each step implements the interface <span class="underline">IWorkflowItem</span>: </p>

<pre>public interface IWorkflowItem {
&#160;&#160;&#160; void run(MyWorkflow inWorkflow) throws WorkflowException;
&#160;&#160;&#160; boolean hasNextStep();
&#160;&#160;&#160; IWorkflowItem getNextStep();
&#160;&#160;&#160; void registerSuccessItem(IWorkflowItem inItem);
&#160;&#160;&#160; void registerFailureItem(IWorkflowItem inItem);
&#160;&#160;&#160; int getReturnCode();
&#160;&#160;&#160; String getErrorMessage();
}</pre>

<p>With the workflow controller <span class="underline">MyWorkflow</span> and the workflow steps set up, the workflow is startet by <span class="underline">MyWorkflow.createWorkflow(inMain, inWorkflowListener).startWorkflow()</span>. This runs the first workflow step which will display e.g. a form where the user can enter some configuration information. When the user clicks the form's save button, the workflow controller's nextStep() method is called which looks up the next workflow item and, if available, runs it by calling its <span class="underline">IWorkflowItem.run()</span> method. This sequence will be iterated for any configured workflow step.<br></p>

</section>

  <footer>
    <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
  </footer>
</div>
<!--[if !IE]><script>fixScale(document);</script><!--<![endif]-->
  
  </body>
</html>
